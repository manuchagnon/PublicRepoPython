from maya import cmds


#####
#
#    Ce script permet de créer des follicules sur une surface en choisissant le nombre de follicules
#    Ou si il n'y a qu'une ligne de follicule sur u ou v, on peut choisir la valeur du parameter
#
#ne fonctionne que sur les surfaces
#
#10/07/2025
#####


def create_follicles_on_surface(surface, count_on_u, param_u, count_on_v, param_v):
    
    shape = surface
    
    count_on_u = int(count_on_u)
    
    count_on_v = int(count_on_v)

    if len(created) > 0 : 
        for i in created :
            cmds.delete(i)
            #created = []
    
    #crée des follicules distribuées sur v
    for i in range(count_on_u):
        for n in range(count_on_v):
            if count_on_u > 1 :
                print(count_on_u)
                u =  float(i) / float(count_on_u - 1)  # espacement équidistant sur U
            else :
                if param_u :
                    param_u = float(param_u)
                else :
                    param_u = 0.5 
                u = param_u
            if  count_on_v > 1 :
                print(count_on_v)
                v =  float(n) / float(count_on_v - 1)  # espacement équidistant sur U
            else : 
                if param_v :
                    param_v = float(param_v)
                else :
                    param_v = 0.5
                v = param_v
            
            follicle_index = len(created)
                
            # Créer le follicle node avec sa shape et son transform
            follicle_shape = cmds.createNode("follicle", name=f"{surface}_follicleShape_{follicle_index}")
            follicle_transform = cmds.listRelatives(follicle_shape, parent=True)[0]
            cmds.rename(follicle_transform, f"{surface}_follicle_{follicle_index}")
            follicle_transform = f"{surface}_follicle_{follicle_index}"
            
            cmds.connectAttr(f"{shape}.local", f"{follicle_shape}.inputSurface", f=True)
            cmds.connectAttr(f"{shape}.worldMatrix[0]", f"{follicle_shape}.inputWorldMatrix", force=True)
            cmds.connectAttr(f"{follicle_shape}.outRotate", f"{follicle_transform}.rotate", f = 1)
            cmds.connectAttr(f"{follicle_shape}.outTranslate", f"{follicle_transform}.translate", f = 1)
    
            
            cmds.setAttr(f"{follicle_shape}.parameterU", u)
            cmds.setAttr(f"{follicle_shape}.parameterV", v)
            
            created.append(follicle_shape)

            
    return created

def button_on(*_) :
    #récupère les données dans les champs de texte
    surface = cmds.textField(follicle_number_field, q=True, text=True)
    count_on_u = cmds.textField(follicle_count_on_u_field, q=True, text=True)
    param_u = cmds.textField(follicle_param_u_field, q=True, text=True)
    count_on_v = cmds.textField(follicle_count_on_v_field, q=True, text=True)
    param_v = cmds.textField(follicle_param_v_field, q=True, text=True)


    
    create_follicles_on_surface(surface, count_on_u, param_u, count_on_v, param_v)

#follicles = create_follicles_on_surface(surface[0], count_on_u = 4, param_u =0.5, count_on_v = 3, param_v=0.5)

#initialiser des variables
created = []

#supprimer la window si elle existe deja
if cmds.window("follicles_on_surface", exists=1):
    cmds.deleteUI("follicles_on_surface")
    
window = cmds.window("follicles_on_surface", title="follicles_on_surface", width=420)
cmds.columnLayout(adjustableColumn=2, rowSpacing=10, columnAlign="left")
cmds.showWindow(window)
    
#nombre de follicles
follicle_number_field = cmds.textField(placeholderText="Write the name of the surface object")
#count_on_u
follicle_count_on_u_field = cmds.textField(placeholderText="Write the amount of follicle on U")

#param_u
follicle_param_u_field = cmds.textField(placeholderText="Write the parameter U you want for a single follicle line on U")

#count_on_v
follicle_count_on_v_field = cmds.textField(placeholderText="Write the amount of follicle on V")

#param_v
follicle_param_v_field = cmds.textField(placeholderText="Write the parameter V you want for a single follicle line on V")

cmds.button(label="Create follicles on surface", height=60, command = button_on)